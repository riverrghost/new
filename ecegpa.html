<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ECE Advanced GPA & CGPA Calculator (Reg 2021)</title>
<style>
  :root{
    --bg:#f4f7fb; --card:#ffffff; --muted:#6b7280; --accent:#0f62fe;
    --success:#16a34a; --danger:#dc2626; --glass: rgba(255,255,255,0.6);
  }
  [data-theme="dark"]{
    --bg:#0b1220; --card:#0f1724; --muted:#94a3b8; --accent:#58a6ff;
    --success:#34d399; --danger:#ff7b7b; --glass: rgba(255,255,255,0.03);
  }

  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--muted); margin:0; padding:24px;}
  .container{max-width:1800px;margin:0 auto;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px;}
  h1{margin:0;font-size:20px;color:var(--muted);}
  .controls{display:flex;gap:10px;align-items:center;}
  select,button{font-size:14px;padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:var(--card);color:var(--muted)}
  button.primary{background:linear-gradient(90deg,var(--accent),#0066d4);color:#fff;border:none}
  button.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:950px){ .grid{grid-template-columns: 1fr 360px;} }

  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06);border:1px solid var(--glass)}
  .semester-card{margin-bottom:12px;border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(0,0,0,0.01), transparent)}
  .semester-head{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px}
  .sem-title{font-weight:600;color:var(--muted)}
  .sem-gpa{font-weight:700;color:var(--accent)}
  .subjects{display:grid;grid-template-columns:1fr 418px;gap:8px}
  .subject{display:flex;flex-direction:column;padding:6px;border-radius:8px}
  .subject label{font-size:13px;color:var(--muted);margin-bottom:6px}
  .grade-select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--muted)}
  .footer-actions{display:flex;gap:8px;margin-top:16px;align-items:center}
  .muted-note{font-size:13px;color:var(--muted);margin-top:8px}
  .status {font-size:13px;padding:6px 8px;border-radius:8px}
  .status.complete{background:linear-gradient(90deg,var(--success),#059669);color:white}
  .status.partial{background:linear-gradient(90deg,#f59e0b,#f97316);color:white}
  .status.empty{background:transparent;color:var(--muted);border:1px dashed rgba(0,0,0,0.06);padding:6px 8px;border-radius:8px}

  /* little helpers */
  .small{font-size:13px}
  .right{text-align:right}
  .divider{height:1px;background:linear-gradient(90deg, rgba(0,0,0,0.03), rgba(0,0,0,0.01));margin:12px 0;border-radius:2px}
  .switch{display:flex;align-items:center;gap:8px}
  input[type="checkbox"]{width:36px;height:20px;appearance:none;background:#e6eefc;border-radius:20px;position:relative;outline:none;cursor:pointer}
  input[type="checkbox"]::after{content:'';position:absolute;top:3px;left:3px;width:14px;height:14px;border-radius:50%;background:white;transition:all .2s;}
  input[type="checkbox"]:checked{background:var(--accent)}
  input[type="checkbox"]:checked::after{transform:translateX(16px)}

  .top-stats{display:flex;gap:12px;align-items:center;justify-content:flex-end}
  .stat{background:rgba(0,0,0,0.03);padding:8px 12px;border-radius:10px;color:var(--muted);font-weight:600}
  .stat .num{display:block;color:var(--accent);font-size:18px}
  .actions-row{display:flex;gap:8px;flex-wrap:wrap}
  .help{font-size:13px;color:var(--muted);margin-top:8px}

</style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <h1>ECE — Advanced GPA & CGPA Calculator (Reg 2021)</h1>
      <div class="controls">
        <div class="switch">
          <label class="small">Dark mode</label>
          <input id="darkToggle" type="checkbox" aria-label="toggle dark mode" />
        </div>
        <select id="semesterUpTo" aria-label="select semester up to">
          <option value="">Select up to semester</option>
          <option value="1">Semester 1</option><option value="2">Semester 2</option>
          <option value="3">Semester 3</option><option value="4">Semester 4</option>
          <option value="5">Semester 5</option><option value="6">Semester 6</option>
          <option value="7">Semester 7</option><option value="8">Semester 8</option>
        </select>
        <div class="top-stats" id="topStats" style="display:none">
          <div class="stat"><span class="num" id="liveCgpa">0.000</span> CGPA</div>
        </div>
      </div>
    </header>

    <div class="grid">
      <div class="card" id="leftColumn">
        <div id="semContainer"></div>

        <div class="divider"></div>

        <div class="actions-row">
          <button id="calcCgpaBtn" class="primary">Calculate Final CGPA</button>
          <button id="saveBtn" class="ghost">Save Now</button>
          <button id="resetBtn" class="ghost">Clear All</button>
        </div>
        <div class="help">Tip: Semester GPAs update live as you select grades. Final CGPA uses only semesters with all grades entered.</div>
      </div>

      <aside class="card" id="rightColumn">
        <h3 style="margin-top:0">Summary</h3>
        <div id="summaryList" class="small"></div>
        <div class="divider"></div>
        <div class="small muted-note">Status legend</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <div class="status complete">Complete</div>
          <div class="status partial">Partial</div>
          <div class="status empty">No grades</div>
        </div>
        <div class="divider"></div>
        <div class="small muted-note">Saved data persists in your browser (LocalStorage).</div>
      </aside>
    </div>
  </div>

<script>
/*
  Advanced ECE GPA/CGPA Calculator (single-file)
  - ECE Regulation 2021 subject list (semester-wise) included
  - Live semester GPA updates
  - CGPA calculation button uses only complete semesters
  - LocalStorage autosave & manual save
  - Dark mode, responsive, animated counters
*/

(() => {
  // ----- configuration: subject lists (code: [name, credits]) -----
  const ECE = {
    1: {
      HS3151: ["Professional English – I", 4],
      MA3151: ["Matrices and Calculus", 4],
      PH3151: ["Engineering Physics", 3],
      CY3151: ["Engineering Chemistry", 3],
      GE3151: ["Problem Solving and Python Programming", 3],
      GE3171: ["Problem Solving and Python Programming Laboratory", 1],
      BS3171: ["Physics and Chemistry Laboratory", 1]
    },
    2: {
      HS3251: ["Professional English – II", 4],
      MA3251: ["Statistics and Numerical Methods", 4],
      PH3254: ["Physics for Electronics Engineering", 3],
      BE3254: ["Electrical and Instrumentation Engineering", 3],
      GE3271: ["Engineering Practices Laboratory", 1],
      EC3271: ["Circuits Analysis Laboratory", 1]
    },
    3: {
      MA3355: ["Random Processes and Linear Algebra", 4],
      CS3353: ["C Programming and Data Structures", 3],
      EC3353: ["Electronic Devices and Circuits", 4],
      GE3361: ["Professional Development", 3],
      EC3361: ["Electronic Devices and Circuits Laboratory", 1],
      CS3362: ["C Programming and Data Structures Laboratory", 1]
    },
    4: {
      EC3452: ["Electromagnetic Fields", 4],
      EC3401: ["Networks and Security", 4],
      EC3451: ["Linear Integrated Circuits", 4],
      EC3492: ["Digital Signal Processing", 4],
      EC3491: ["Communication Systems", 4],
      GE3451: ["Environmental Sciences and Sustainability", 3],
      EC3461: ["Communication Systems Laboratory", 1],
      EC3462: ["Linear Integrated Circuits Laboratory", 1]
    },
    5: {
      EC3501: ["Wireless Communication", 3],
      EC3552: ["VLSI and Chip Design", 3],
      EC3551: ["Transmission Lines and RF Systems", 3],
      PE1: ["Professional Elective I", 3],
      OE1: ["Open Elective I", 3],
      EC3561: ["VLSI Laboratory", 1]
    },
    6: {
      ET3491: ["Embedded Systems and IoT Design", 3],
      CS3491: ["Artificial Intelligence and Machine Learning", 3],
      PE2: ["Professional Elective II", 3],
      PE3: ["Professional Elective III", 3],
      OE2: ["Open Elective II", 3]
    },
    7: {
      GE3791: ["Human Values and Ethics", 2],
      EC3711: ["Summer Internship", 1],
      PE4: ["Professional Elective IV", 3],
      PE5: ["Professional Elective V", 3],
      PE6: ["Professional Elective VI", 3],
      OE3: ["Open Elective III", 3]
    },
    8: {
      EC3811: ["Project Work / Internship", 10]
    }
  };

  const GRADE_POINTS = { "O":10, "A+":9, "A":8, "B+":7, "B":6, "C":5, "RA":0, "U/A":0 };

  // DOM elements
  const semesterUpToSelect = document.getElementById('semesterUpTo');
  const semContainer = document.getElementById('semContainer');
  const calcCgpaBtn = document.getElementById('calcCgpaBtn');
  const resetBtn = document.getElementById('resetBtn');
  const saveBtn = document.getElementById('saveBtn');
  const summaryList = document.getElementById('summaryList');
  const resultArea = document.getElementById('result');
  const topStats = document.getElementById('topStats');
  const liveCgpaElem = document.getElementById('liveCgpa');
  const darkToggle = document.getElementById('darkToggle');

  // storage key
  const STORAGE_KEY = 'ece_gpa_data_v1';

  // state
  let selectedUpTo = null;
  // grades: { sem: { code: grade, ... }, ... }
  let grades = loadFromStorage() || {};

  // helper: save to localStorage
  function saveToStorage(){
    const payload = { selectedUpTo, grades, timestamp: Date.now() };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    flashMessage('Saved');
  }
  function loadFromStorage(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      const data = JSON.parse(raw);
      // restore
      selectedUpTo = data.selectedUpTo || null;
      if (selectedUpTo) semesterUpToSelect.value = selectedUpTo;
      grades = data.grades || {};
      return data;
    } catch(e){ console.warn('load error', e); return null; }
  }
  function clearStorage(){
    localStorage.removeItem(STORAGE_KEY);
    grades = {};
    selectedUpTo = null;
  }

  // UI helpers
  function flashMessage(msg){
    // tiny ephemeral hint
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position='fixed';el.style.right='20px';el.style.bottom='20px';
    el.style.background='rgba(0,0,0,0.75)';el.style.color='#fff';el.style.padding='8px 12px';
    el.style.borderRadius='8px';el.style.zIndex=9999;document.body.appendChild(el);
    setTimeout(()=>el.style.opacity='0',1100); setTimeout(()=>el.remove(),1600);
  }

  // animate number helper (nice-looking counter)
  function animateNumber(el, from, to, duration=700) {
    const start = performance.now();
    function frame(now){
      const t = Math.min(1, (now - start) / duration);
      const val = from + (to - from) * t;
      el.textContent = val.toFixed(3);
      if (t < 1) requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }

  // build semester DOMs for 1..upTo
  function renderSemesters(upTo){
    selectedUpTo = upTo;
    semContainer.innerHTML = '';
    summaryList.innerHTML = '';
    if (!upTo) return;

    topStats.style.display = 'flex';
    // render each semester
    for (let s=1; s<=upTo; s++){
      const semCard = document.createElement('div');
      semCard.className = 'semester-card card';
      semCard.dataset.sem = s;

      const header = document.createElement('div');
      header.className = 'semester-head';
      const t = document.createElement('div'); t.className='sem-title'; t.textContent = `Semester ${s}`;
      const status = document.createElement('div'); status.className='sem-gpa small'; status.textContent = 'GPA: —';
      header.appendChild(t); header.appendChild(status);
      semCard.appendChild(header);

      const subjectsGrid = document.createElement('div');
      subjectsGrid.className = 'subjects';

      // subjects for this sem
      const subjObj = ECE[s] || {};
      for (let code in subjObj){
        const [name, credit] = subjObj[code];
        const wrapper = document.createElement('div');
        wrapper.className = 'subject';
        wrapper.innerHTML = `
          <label>${code} — ${name} <span class="small" style="color:var(--muted)">(${credit} cr)</span></label>
          <select class="grade-select" data-sem="${s}" data-code="${code}" aria-label="${code} grade">
            <option value="">— grade —</option>
            <option>O</option><option>A+</option><option>A</option>
            <option>B+</option><option>B</option><option>C</option>
            <option>RA</option><option>U/A</option>
          </select>
        `;
        subjectsGrid.appendChild(wrapper);
      }

      semCard.appendChild(subjectsGrid);
      semContainer.appendChild(semCard);

      // summary column entry
      const sumItem = document.createElement('div');
      sumItem.id = `summary-sem-${s}`;
      sumItem.className='small';
      sumItem.textContent = `Sem ${s}: —`;
      summaryList.appendChild(sumItem);
    }

    // attach listeners
    attachGradeListeners();
    // restore grade values from state (if saved)
    restoreGradesToUI();
    // initial compute for each semester (in case some are saved)
    for (let s=1; s<=upTo; s++) computeSemesterGPA(s);
  }

  function attachGradeListeners(){
    const selects = semContainer.querySelectorAll('select.grade-select');
    selects.forEach(sel => {
      sel.addEventListener('change', (e) => {
        const sem = parseInt(sel.dataset.sem);
        const code = sel.dataset.code;
        const val = sel.value;
        // update state
        grades[sem] = grades[sem] || {};
        if (val) grades[sem][code] = val;
        else delete grades[sem][code];
        // autosave
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ selectedUpTo, grades, timestamp: Date.now() }));
        // compute sem gpa live
        computeSemesterGPA(sem);
      });
    });
  }

  // compute one semester GPA (partial allowed). returns object {gpa,complete,points,credits}
  function computeSemesterGPA(sem){
    const subjObj = ECE[sem] || {};
    let points = 0, credits = 0, filled = 0, totalSubjects=0;
    for (let code in subjObj){
      totalSubjects++;
      const credit = subjObj[code][1];
      const grade = (grades[sem] && grades[sem][code]) ? grades[sem][code] : '';
      if (grade && (grade in GRADE_POINTS)){
        points += GRADE_POINTS[grade] * credit;
        credits += credit;
        filled++;
      }
    }
    const complete = (filled === totalSubjects && totalSubjects>0);
    const gpa = credits>0 ? (points/credits) : null;

    // update DOM display for this sem
    const semCard = semContainer.querySelector(`.semester-card[data-sem="${sem}"]`);
    if (!semCard) return {gpa:null,complete:false,points,credits};
    const statusElem = semCard.querySelector('.sem-gpa');
    const summaryElem = document.getElementById(`summary-sem-${sem}`);
    if (gpa !== null){
      // animate number update
      const prev = parseFloat(statusElem.dataset.gpa || 0) || 0;
      statusElem.dataset.gpa = gpa.toFixed(3);
      animateNumber(statusElem, prev, gpa, 400);
      statusElem.style.color = complete ? 'var(--success)' : 'var(--accent)';
    } else {
      statusElem.textContent = 'GPA: —';
      statusElem.dataset.gpa = 0;
    }

    // summary
    if (complete){
      summaryElem.textContent = `Sem ${sem}: ${gpa.toFixed(3)} (complete)`;
    } else if (filled>0){
      summaryElem.textContent = `Sem ${sem}: ${ (gpa !== null ? gpa.toFixed(3) : '—') } (partial)`;
    } else {
      summaryElem.textContent = `Sem ${sem}: —`;
    }

    // set a small badge style
    if (complete) summaryElem.style.color='var(--success)'; else if (filled>0) summaryElem.style.color='var(--accent)'; else summaryElem.style.color='var(--muted)';

    // update live CGPA metric (show using only complete semesters)
    updateLiveCgpaPreview();

    return {gpa,complete,points,credits};
  }

  // compute CGPA using only complete semesters (or all with option)
  function computeFinalCgpa(usePartial=false){
    const upTo = selectedUpTo || 0;
    let totalPoints = 0, totalCredits = 0;
    for (let s=1; s<=upTo; s++){
      const res = computeSemesterGPA(s);
      // if not complete and not allowed partial skip
      if (!res.credits) continue;
      if (!res.complete && !usePartial) continue;
      totalPoints += res.points;
      totalCredits += res.credits;
    }
    const cgpa = totalCredits ? (totalPoints/totalCredits) : null;
    return {cgpa, totalPoints, totalCredits};
  }

  function updateLiveCgpaPreview(){
    // show CGPA preview using only complete semesters
    const res = computeFinalCgpa(false);
    if (res.cgpa !== null){
      animateNumber(liveCgpaElem, parseFloat(liveCgpaElem.textContent) || 0, res.cgpa, 400);
    } else {
      // set to 0.000
      animateNumber(liveCgpaElem, parseFloat(liveCgpaElem.textContent) || 0, 0, 300);
    }
  }

  // restore saved grades to UI selects
  function restoreGradesToUI(){
    if (!grades) return;
    for (let sem in grades){
      const subjObj = grades[sem] || {};
      for (let code in subjObj){
        const val = subjObj[code];
        const sel = semContainer.querySelector(`select[data-sem="${sem}"][data-code="${code}"]`);
        if (sel) sel.value = val;
      }
    }
  }

  // UI actions
  semesterUpToSelect.addEventListener('change', (e) => {
    const val = parseInt(e.target.value);
    if (!isNaN(val)) {
      selectedUpTo = val;
      renderSemesters(val);
      // save selection
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ selectedUpTo, grades, timestamp: Date.now() }));
    } else {
      semContainer.innerHTML='';
    }
  });

  calcCgpaBtn.addEventListener('click', (e) => {
    const allowPartial = confirm('Include partial semesters (semesters with some grades but not all)? Click OK for yes, Cancel for no.');
    const res = computeFinalCgpa(allowPartial);
    if (res.cgpa !== null){
      resultArea.textContent = `Final CGPA: ${res.cgpa.toFixed(3)}  —  (Credits: ${res.totalCredits})`;
      flashMessage('CGPA calculated');
    } else {
      resultArea.textContent = 'No complete semester data available to calculate CGPA. Enter grades or allow partial semesters.';
    }
  });

  saveBtn.addEventListener('click', () => saveToStorage());
  resetBtn.addEventListener('click', () => {
    if (!confirm('Clear all saved grades and reset the form?')) return;
    clearStorage();
    semContainer.innerHTML = '';
    summaryList.innerHTML = '';
    resultArea.textContent = '';
    semesterUpToSelect.value = '';
    topStats.style.display = 'none';
    animateNumber(liveCgpaElem, parseFloat(liveCgpaElem.textContent) || 0, 0, 400);
    flashMessage('Cleared');
  });

  // keyboard-friendly: Ctrl+S to save
  window.addEventListener('keydown', (e) => {
    if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s') {
      e.preventDefault();
      saveToStorage();
    }
  });

  // dark mode toggle
  const doc = document.documentElement;
  darkToggle.addEventListener('change', (e) => {
    if (e.target.checked) { doc.setAttribute('data-theme','dark'); } else { doc.removeAttribute('data-theme'); }
  });

  // restore from storage on load
  (function init(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw){
      try {
        const data = JSON.parse(raw);
        if (data.selectedUpTo) {
          semesterUpToSelect.value = data.selectedUpTo;
          selectedUpTo = data.selectedUpTo;
          grades = data.grades || {};
          renderSemesters(selectedUpTo);
        }
      } catch(e){}
    }
  })();

})();
</script>
</body>
</html>
